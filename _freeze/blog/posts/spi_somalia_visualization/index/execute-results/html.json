{
  "hash": "b5a394c9e31b6a3b3e084ac9a6cc15d4",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"How to compute and visualize the standardized precipitation index (SPI) for drought analysis\"\nsubtitle: \"Part 2: Visualizing the SPI from Somalia at subnational level using {ggplot2} in R\"\nauthor: \n - name: \n    given: Juan Armando \n    family: Torres Mungu√≠a\ndate: \"2025-02-08\"\ncategories: \n - data visualization\n - drought\n - tidyverse\n - ggplot2\n - shapefiles\n - standardized precipitation index (SPI)\n - Somalia\nimage: \"spi-somalia.png\"\ntitle-block-banner: false\ncitation: true\nexecute: \n  freeze: true\nformat: \n  html: \n    page-layout: article\ncomments:\n  utterances: \n    repo: jatorresmunguia/juan-torresmunguia.github.io\n---\n\n\n## Overview\nPreviously, we calculated the Standardized Precipitation Index (SPI) for different time scales using the {SCI} package in R. In this tutorial, we will visualize the SPI values for Somalia at the subnational level using {ggplot2} and shapefiles.\n\n## About the data\nThe information of the Somalian sub national administrative boundaries is obtained from the [Humanitarian Data Exchange (HDX) initiative](https://data.humdata.org/) of the United Nations Office for the Coordination of Humanitarian Affairs (OCHA). The information comes as a shapefile `.shp` and is available at https://data.humdata.org/dataset/cod-ab-som? in a zip file named `som_adm_ocha_20250108_AB_SHP.zip`. The shapefile contains the administrative boundaries of Somalia at the subnational level (regions). In particular, we will use file `som_admbnda_adm1_ocha_20250108.shp`, that contains the shapefile for the subnational regions of Somalia. I downloaded this file and located it in the `shp` folder.\n\n## Set-up\nBefore we begin, we need to install and load the necessary R packages. We will be using the {tidyverse} package for data wrangling, as well as the {SCI} package for calculating the SPI.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # For data manipulation and visualization\nlibrary(sf) # For handling spatial data\nlibrary(ggplot2) # For data visualization\n```\n:::\n\n\n## Loading data HDX\nData can be found [here](https://data.humdata.org/dataset/som-rainfall-subnational) in file `som-rainfall-adm2-full.csv`. For Somalia, data is available from January 1981.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read the rainfall data for Somalia`\n# You can also download the data from the HDX platform and read it locally\nrainfall_data <- read.csv(\"https://data.humdata.org/dataset/ed6e1b4b-8094-47e6-bdf7-f6d56fa7abb9/resource/331ab214-0860-44ea-a53b-0a3fac601e82/download/som-rainfall-adm2-full.csv\")\n```\n:::\n\n\n### Data wrangling\nWe preprocess the data to extract relevant information to calculate the SPI. We extract the year and month from the date column, calculate the rainfall anomaly, and group the data by year, month, and region_code. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nrainfall_data <- rainfall_data |>\n  slice(-1) |> # Remove the first row (metadata)\n  mutate(\n    year = year(date), # Extract year from the 'date' column\n    month = month(date), # Extract month from the 'date' column\n    region_code = substr(ADM2_PCODE, 1, 4) # Extract first 4 characters from 'ADM2_PCODE' as 'region_code'\n    ) |>\n  rename(\n    rainfall_monthly_total = rfh, # Rename the column 'rfh' to 'rainfall_monthly_total'\n    rainfall_monthly_lt_average = rfh_avg # Rename the column 'rfh_avg' to 'rainfall_monthly_lt_average'\n    ) |>\n  mutate(\n    rainfall_monthly_total = as.numeric(rainfall_monthly_total), # Convert rainfall total to numeric\n    rainfall_monthly_lt_average = as.numeric(rainfall_monthly_lt_average) # Convert long-term average to numeric\n  ) |>\n  select(year, month, region_code, rainfall_monthly_total, rainfall_monthly_lt_average) # Select relevant columns\n\n# Group by year, month, and region_code, and calculate mean rainfall values by region\nrainfall_data <- rainfall_data |>\n  group_by(year, month, region_code) |>\n  summarise(\n    rainfall_monthly_total = mean(rainfall_monthly_total, na.rm = TRUE), # Calculate the mean of rainfall total\n    rainfall_monthly_lt_average = mean(rainfall_monthly_lt_average, na.rm = TRUE) # Calculate the mean of long-term average\n  ) |>\n  ungroup() |>\n  # Optionally, you can calculate rainfall anomaly as a percentage of the long-term average\n  # rainfall_anomaly = 1, indicates no anomaly \n  # < 1 indicates below average \n  # > 1 indicates above average\n  mutate(\n    rainfall_anomaly = rainfall_monthly_total / rainfall_monthly_lt_average \n  )\n```\n:::\n\n\n## We then calculate the SPI for different time scales (1, 3, 6, 12 months).\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}