{
  "hash": "0fd4015d57821b25e7e66d35f7c6273b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Using a tidy approach in R to analyze the 2024 Mexico's ENVIPE\"\nsubtitle: \"Part 1: Estimating crime prevalence\"\nauthor: \"\"\ndate: \"2025-01-27\"\ncategories: \n - official statistics\n - Mexico\n - household surveys\n - ENVIPE\n - crime\n - victimization\n - public safety\n - tidyverse\n - microdata\nimage: \"image.png\"\ntitle-block-banner: false\ncitation: true\nexecute: \n  freeze: true\nformat: \n  html: \n    page-layout: article\n---\n\n\n### Overview\nIn this article, I will walk you through the steps of analyzing the 2024 Mexico's National Survey of Victimization and Perception of Public Safety (ENVIPE) by using the [`tidyverse`](https://www.tidyverse.org/) framework. At the end, you will be able to apply this collection of packages to:\n\n- Load the survey microdata from INEGI's website\n- Specify the ENVIPE's survey design\n- Calculate point estimates and standard errors\n- Tabulate main results\n\n### About the ENVIPE\nThe ENVIPE is an official survey that collects national and state level representative information on the household experiences crime victimization and their perceptions of public safety in Mexico. The ENVIPE is conducted annually by the [National Institute of Statistics and Geography (INEGI)](https://www.inegi.org.mx/default.html) since 2011.\n\nAll the information related to the survey, including questionnaires, methodology, glossary of terms, summaries, and microdata is fully available at [INEGI's website](https://en.www.inegi.org.mx/programas/envipe/2024/).\n\n### Set-up\nFirst, you will need to install and load the following packages to use the R code in this post: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # for tidy framework\nlibrary(survey) # analysis of survey data\nlibrary(srvyr) # tidy syntax for analysis of survey data\n\nlibrary(archive) # to extract files from a zip folder\n```\n:::\n\n\n### Load the survey microdata from INEGI’s website\nMicrodata can be found at [https://www.inegi.org.mx/programas/envipe/2024/#microdatos](https://www.inegi.org.mx/programas/envipe/2024/#microdatos) in different formats, including csv, dbf, dta, sav, and RData. I choose to work with RData files.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(archive_read(archive = \"https://www.inegi.org.mx/contenidos/programas/envipe/2024/microdatos/bd_envipe_2024_RData.zip\",\n                  file = \"BD_ENVIPE_2024.RData\"))\n```\n:::\n\n\n::: {.callout-tip}\n\nAs you can see, by using the `archive` package it is possible to read the single file from `bd_envipe_2024_RData.zip` in a direct way. \n\n:::\n\nAfter this, we have the following objects in the global environment: \n\n- `THogar`: This object contains the interview result, the row of the selected respondent, the household factor, and other household characteristics.\n\n- `TMod_Vic`: This object includes information on the crimes suffered by the selected respondent and their household during the reference year, specifically during 2023.\n\n- `TPer_Vic1`: This object includes information related to the perception of public security within the respondent’s geographic area, antisocial behaviors in their immediate surroundings, and changes in habits due to fear of becoming a crime victim in 2023. Additionally, it presents information regarding the performance of authorities and trust in them. In other words, this table covers Sections IV and V of the main questionnaire.\n\n- `TPer_Vic2`: This object consolidates information related to household and personal victimization, particularly focusing on high-impact crimes experienced by the household (such as kidnapping, enforced disappearance, or homicide) or by the selected respondent. This table includes Sections VI and VII of the main questionnaire.\n\n- `TSDem`: This object contains the socio-demographic characteristics of household members, corresponding to Section III of the main questionnaire.\n\n- `TSVivienda`: This object contains the characteristics of the households captured through the questionnaire cover page, as well as the count of household residents and the number of households. In other words, it includes Sections I and II of the main questionnaire.\n\n### Specify the ENVIPE’s survey design\nENVIPE's survey scheme is a probabilistic, three-stage, stratified, and cluster sampling. Observation unit is the selected private household, the households, the household residents, and the selected person within the household. The sampling unit are the households. The unit of analysis are the population aged 18 and older residing in the selected private households in the sample. More information about this can be found in the following documents (only in Spanish):\n\n- [Sampling design](https://www.inegi.org.mx/contenidos/productos/prod_serv/contenidos/espanol/bvinegi/productos/nueva_estruc/889463920014.pdf)\n\n### Calculate point estimates and standard errors\n#### Crime prevalence rate per one hundred thousand inhabitants by state and by victim's sex\nLet's first recreate the [prevalence rate estimates by state and by victim's sex](https://www.inegi.org.mx/app/tabulados/interactivos/?px=ENVIPE_PREVALENCIA_ENT_FED_SEXO&bd=ENVIPE). To achieve this, we use `TPer_Vic2` (household and personal victimization) and `TSDem` (socio-demographic characteristics of household members). \n\n\n::: {.cell}\n\n```{.r .cell-code}\nid_victims <- TMod_Vic |>\n  filter(BPCOD != \"03\") |>\n  pull(ID_PER)\n\nTPer_Vic2 <- TPer_Vic2 |> \n  mutate(FAC_ELE = as.numeric(FAC_ELE))\n\nTPer_Vic2 <- TPer_Vic2 |>\n  mutate(victim = case_when(\n    ID_PER %in% id_victims ~ 1, \n    TRUE ~ 0\n  ))\n\nenvipe_design <- TPer_Vic2 |>\n  as_survey_design(weights = FAC_ELE,\n                   strata = EST_DIS,\n                   ids = UPM_DIS,\n                   nest = TRUE)\n\nenvipe_design |>\n  survey_count(victim, name = \"Absolutos\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  victim Absolutos Absolutos_se\n   <dbl>     <dbl>        <dbl>\n1      0  72105299      366104.\n2      1  21932301      239427.\n```\n\n\n:::\n\n```{.r .cell-code}\nenvipe_design |>\n  group_by(NOM_ENT) |>\n  survey_count(victim, name = \"Absolute\") |>\n  mutate(`Total population aged 18 and over` = sum(Absolute)) |>\n  mutate(`Proportion` = Absolute/`Total population aged 18 and over`*100) |>\n  ungroup() |>\n  filter(victim == 1) |>\n  select()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 32 × 0\n```\n\n\n:::\n\n```{.r .cell-code}\nenvipe_design |>\n  group_by(NOM_ENT) |>\n  summarize(\n    Proportion = survey_mean(victim),\n    N = survey_total(victim)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 32 × 5\n   NOM_ENT              Proportion Proportion_se       N   N_se\n   <chr>                     <dbl>         <dbl>   <dbl>  <dbl>\n 1 AGUASCALIENTES            0.328       0.0136   342231 16291.\n 2 BAJA CALIFORNIA           0.238       0.0117   658657 32075.\n 3 BAJA CALIFORNIA SUR       0.216       0.0100   139622  8402.\n 4 CAMPECHE                  0.226       0.0102   152787  7574.\n 5 CHIAPAS                   0.141       0.00743  507741 26588.\n 6 CHIHUAHUA                 0.226       0.00848  632297 25743.\n 7 CIUDAD DE MEXICO          0.325       0.00754 2473701 62817.\n 8 COAHUILA DE ZARAGOZA      0.194       0.00904  463234 21934.\n 9 COLIMA                    0.212       0.0101   115624  6001.\n10 DURANGO                   0.164       0.00788  216134 11716.\n# ℹ 22 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\nenvipe_design |>\n  group_by(interact(NOM_ENT, SEXO)) |>\n  summarize(\n    Proportion = survey_mean(victim),\n    N = survey_total(victim)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 64 × 6\n   NOM_ENT             SEXO  Proportion Proportion_se      N   N_se\n   <chr>               <chr>      <dbl>         <dbl>  <dbl>  <dbl>\n 1 AGUASCALIENTES      1          0.337       0.0217  159381 12234.\n 2 AGUASCALIENTES      2          0.320       0.0183  182850 12013.\n 3 BAJA CALIFORNIA     1          0.230       0.0160  303760 21785.\n 4 BAJA CALIFORNIA     2          0.245       0.0154  354897 24430.\n 5 BAJA CALIFORNIA SUR 1          0.193       0.0124   61094  4576.\n 6 BAJA CALIFORNIA SUR 2          0.238       0.0147   78528  6060.\n 7 CAMPECHE            1          0.218       0.0146   69975  5338.\n 8 CAMPECHE            2          0.232       0.0138   82812  5139.\n 9 CHIAPAS             1          0.166       0.00986 271846 17451.\n10 CHIAPAS             2          0.121       0.00979 235895 18467.\n# ℹ 54 more rows\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}